<app-page-loading [stretch_height]="false" [icon_size]="'2x'"  *ngIf="fetching"></app-page-loading>

<app-confirmation-dialog 
    #clear_logins_confirm
    [modalTitle]="'Log everyone out?'"
    [modalText]="'<div class=\'text-warning\'>This will log out your account from all devices, except this one.</div>Are you sure?'"
    [btnYesClass]="'btn-danger'"
    [btnYesIcon]="faBan"
    (confirm)="clearLogins_confirmed()"
    />

<app-confirmation-dialog 
    #clear_single_login_confirm
    [modalTitle]="'Cancel this login?'"
    [modalText]="'<div class=\'text-warning\'>This will log out this device.</div>Are you sure?'"
    [btnYesClass]="'btn-danger'"
    [btnYesIcon]="faBan"
    (confirm)="clearLogins_confirmed()"
    />

<div *ngIf="!fetching">
    <table class="table table-responsive table-striped table-hover">
    <thead>
      <tr>
        <th scope="col">Runtime</th>
        <th scope="col">Logged in at</th>
        <th scope="col">Location</th>
        <th scope="col">Map</th>
      </tr>
    </thead>
    <tbody>
      <tr 
        *ngFor="let login of user_logins" >
        <td>            
            {{ ((login.origin_browser)? login.origin_browser :'Unknown browser') }}
            {{ ((login.origin_os)? (login.origin_browser? 'on ':'') + login.origin_os :'Unknown OS') }}
            <div *ngIf="login.is_current_login" class="text-success">This login</div>
            <div *ngIf="!login.is_current_login"><a class="text-danger" href="javascript:void(0)" (click)="clear_login(login.id)">Log this out</a></div>
        </td>
        <td>
            {{ login.logged_in_at | dateStr }} 
        </td>
        <td>
            {{ login.origin_city ? login.origin_city : "" }}{{ 
                login.origin_country ? ((login.origin_city)? ', ':'' ) + login.origin_country : 'Unknown country' 
            }}
            <div>{{ login.origin_ip_address }}</div>
        <td>
            <iframe *ngIf="login.origin_geolocation"
                width="150" 
                height="150" 
                frameborder="0" 
                scrolling="no" 
                marginheight="0" 
                marginwidth="0" 
                [src]="'https://maps.google.com/maps?q=' + login.origin_geolocation + '&hl=en&z=16&output=embed' | safe"
                >
                </iframe>
            <span *ngIf="!login.origin_geolocation">Unknown location</span>
        </td>
      </tr>
    </tbody>
  </table>

  <div class="d-flex justify-content-center">
    <button class="btn btn-danger clear-button" (click)="clearAllLogins()" [disabled]="((clearning) || (number_of_external_logins <= 0))">
        <span *ngIf="!clearning">
            <fa-icon [icon]="faBan" ></fa-icon>
            <span style="margin-left: 10px;">Log out from all other devices</span>
        </span>
        <fa-icon [icon]="faArrowsRotate" [animation]="'spin'" class="action-icon" *ngIf="clearning"></fa-icon>
    </button>
  </div>
</div>