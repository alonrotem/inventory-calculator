<app-confirmation-dialog #delete_allocation_dialog
  modalTitle="Delete confirmation"
  modalText="Are you sure you wish to delete this allocation?<br/>All its babies will be removed too!"
  [btnYesIcon]=faTrashCan
  btnYesText="Delete"
  btnYesClass="btn-danger"
/>

<div style="border: 1px solid; padding: 20px; border-radius: 20px; margin: 20px 0px;">
<div>
    <h5 style="display: inline-block; margin-right: 10px;" title="Click to go to raw material ({{ bank.raw_material_name }})">
        <span 
            class="hover-warning" 
            role="button"
            routerLink="/inventory/raw/editor" [queryParams]="{ id: bank.raw_material_id }">
            <span class="icon-leaf" style="margin-right: 10px;"></span>
            Raw Material Bank: {{ bank.raw_material_name }}
        </span>
    </h5>
    <div style="display: flex; flex-direction: row; flex-wrap: nowrap; justify-content: flex-start; align-items: center;"><span>{{ bank.quantity }} {{ raw_material_quantity_units }} ({{ bank.remaining_quantity }} remaining)</span> <span><button class="btn btn-primary" style="padding: 0px 11px 3px 5px; margin-left: 10px;" *ngIf="(banks_baby_allocations | filter: 'customer_bank_id' : bank.id).length > 0">+ New work allocation</button></span></div>
</div>

<!-- allocations from this bank -->
 <div *ngIf="(banks_baby_allocations | filter: 'customer_bank_id' : bank.id).length > 0">

 
 <ng-container *ngFor="let bank_allocation of banks_baby_allocations | filter: 'customer_bank_id' : bank.id">
 <hr  style="margin: 30px 0px;" />
 <div>
      <div>
        <fa-icon [icon]="faChartPie" style="margin-right:10px;"></fa-icon>
        <strong>Allocated for work:</strong>
        {{ bank_allocation.quantity }} {{ raw_material_quantity_units }}, {{ (babies | filter: "customer_banks_babies_id" : bank_allocation.id).length }} babies 
        <fa-icon class="text-danger" [icon]="faTrashCan" title="Delete this allocation and all babies" (click)="delete_allocation(bank_allocation.id)"></fa-icon>
      </div>

        <table class="table table-responsive table-striped table-hover">
            <thead>
              <tr>
                <th scope="col">Length</th>
                <th scope="col">Quantity</th>
                <th scope="col" class="text-center">Remove</th>
              </tr>
            </thead>
            <tbody>
                <ng-container *ngFor="let baby of babies;">
              <tr *ngIf="baby.customer_banks_babies_id == bank_allocation.id"> <!--
                routerLink="/inventory/customer/editor" 
                [queryParams]="{ id: customer.id }" role="button">-->
                <td>{{ baby.length | number : '1.1-1' }} cm</td>
                <td>{{ baby.quantity }}</td>
                <td class="text-center"><fa-icon class="text-danger" [icon]="faTrashCan"></fa-icon></td>
              </tr>
                </ng-container>
            </tbody>
          </table>        
    <!--</div>-->
</div>
</ng-container>
</div>
<div style="height: 160px; display: flex; flex-direction: column; flex-wrap: nowrap; justify-content: center; align-items: center; line-height: 40px;" *ngIf="(banks_baby_allocations | filter: 'customer_bank_id' : bank.id).length == 0">
  <div><fa-icon [icon]="faTriangleExclamation" size="2x"></fa-icon></div>
  <div>No material allocated for work in this bank.</div>
  <div>Add some by clicking the <button class="btn btn-primary" style="padding: 0px 11px 3px 5px;">+ New work allocation</button> button.</div>
</div>
</div>